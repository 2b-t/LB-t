name: Tests

on:
  repository_dispatch:
    types: [trigger-tests]

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    container:
      image: tobitflatscher/lbt
      volumes:
        - ${{ github.workspace }}:/code/lbt
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Create build folder
        run: mkdir build
      - name: Run CMake
        run: cmake -B /code/lbt/build -S /code/lbt -D VTK_DIR=/code/lbt/../VTK-build -D ENABLE_COVERAGE=True
      - name: Compile with Make
        run: make -j $(nproc) -C /code/lbt/build
      - name: Run unit tests
        run: (cd /code/lbt/build && ctest)
      - name: Upload coverage reports to Codecov
        uses: codecov/codecov-action@v3

